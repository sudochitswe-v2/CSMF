@using CSMF.WebMvc.Domain.Entities.Users
@using Microsoft.AspNetCore.Identity
@using System.Security.Claims

@inject UserManager<SystemUser> _userManager
@inject SignInManager<SystemUser> _signInManager

<div class="accordion" id="sidebarAccordion">

    <!-- Dashboard (Top-Level Link) -->
    <a class="nav-link py-3 px-3 @(ViewContext.RouteData.Values["Action"].ToString() == "Index" && ViewContext.RouteData.Values["Controller"].ToString() == "Home" ? "active" : "")"
       asp-controller="Home" asp-action="Index">
        <i class="bi bi-house-door me-2"></i> Dashboard
    </a>

    <!-- Users -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingUsers">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUsers" aria-expanded="false" aria-controls="collapseUsers">
                <i class="bi bi-people me-2"></i> Users
            </button>
        </h2>
        <div id="collapseUsers" class="accordion-collapse collapse @(ViewContext.RouteData.Values["Controller"].ToString() == "Users" ? "show" : "")" aria-labelledby="headingUsers" data-bs-parent="#sidebarAccordion">
            <div class="accordion-body p-0">
                <div class="nav flex-column">
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "Index" ? "active" : "")" asp-controller="Users" asp-action="Index">All Users</a>
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "Roles" ? "active" : "")" asp-controller="Users" asp-action="Roles">User Roles</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Products -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingProducts">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProducts" aria-expanded="false" aria-controls="collapseProducts">
                <i class="bi bi-cart me-2"></i> Products
            </button>
        </h2>
        <div id="collapseProducts" class="accordion-collapse collapse @(ViewContext.RouteData.Values["Controller"].ToString() == "Products" ? "show" : "")" aria-labelledby="headingProducts" data-bs-parent="#sidebarAccordion">
            <div class="accordion-body p-0">
                <div class="nav flex-column">
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "Index" ? "active" : "")" asp-controller="Products" asp-action="Index">All Products</a>
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "Create" ? "active" : "")" asp-controller="Products" asp-action="Create">Add Product</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingSettings">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false" aria-controls="collapseSettings">
                <i class="bi bi-gear me-2"></i> Settings
            </button>
        </h2>
        <div id="collapseSettings" class="accordion-collapse collapse @(ViewContext.RouteData.Values["Controller"].ToString() == "Settings" ? "show" : "")" aria-labelledby="headingSettings" data-bs-parent="#sidebarAccordion">
            <div class="accordion-body p-0">
                <div class="nav flex-column">
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "General" ? "active" : "")" asp-controller="Settings" asp-action="General">General</a>
                    <a class="nav-link py-2 px-4 @(ViewContext.RouteData.Values["Action"].ToString() == "Security" ? "active" : "")" asp-controller="Settings" asp-action="Security">Security</a>
                </div>
            </div>
        </div>
    </div>
    @if (User is not null && User.Identity.IsAuthenticated)
    {
        <!-- User Profile Section -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingUserProfile">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUserProfile" aria-expanded="false" aria-controls="collapseUserProfile">
                    <i class="bi bi-person-check me-2"></i> @User.Identity.Name
                </button>
            </h2>
            <div id="collapseUserProfile" class="accordion-collapse collapse @(ViewContext.RouteData.Values["Controller"].ToString() == "Account" ? "show" : "")" aria-labelledby="headingUserProfile" data-bs-parent="#sidebarAccordion">
                <div class="accordion-body p-0">
                    <form asp-controller="Account" asp-action="Logout" method="post" id="logoutForm" class="form-inline">
                        <button type="submit" class="btn btn-link nav-link py-3 px-3 w-100 text-start text-danger">
                            <i class="bi bi-box-arrow-right me-2"></i> Logout
                        </button>
                    </form>
                </div>
            </div>
        </div>
    }

</div>